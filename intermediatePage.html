<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الانتقال بعد 10 ثوانٍ</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f9f9f9;
            font-family: Arial, sans-serif;
            direction: rtl;
        }

        #countdownContainer {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .circle {
            fill: none;
            stroke-width: 10;
        }

        .background-circle {
            stroke: #e0e0e0;
        }

        .progress-circle {
            stroke: #4CAF50;
            transition: stroke-dashoffset 1s linear;
        }

        #countdownText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #333;
        }

        #message {
            margin-top: 20px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="countdownContainer">
        <svg width="120" height="120">
            <circle class="circle background-circle" cx="60" cy="60" r="50"></circle>
            <circle class="circle progress-circle" cx="60" cy="60" r="50" stroke-dasharray="314" stroke-dashoffset="0"></circle>
        </svg>
        <div id="countdownText">10</div>
    </div>
    <div id="message">يرجى الانتظار، سيتم الانتقال تلقائياً بعد انتهاء العد التنازلي</div>

    <script>
        let countdownValue = 10;
        const countdownText = document.getElementById('countdownText');
        const progressCircle = document.querySelector('.progress-circle');
        const circumference = 2 * Math.PI * 50;

        progressCircle.style.strokeDasharray = circumference;

        function updateCountdown() {
            countdownValue -= 1;
            countdownText.textContent = countdownValue;

            const offset = circumference - (countdownValue / 10) * circumference;
            progressCircle.style.strokeDashoffset = offset;

            if (countdownValue <= 0) {
                clearInterval(countdownInterval);
                verifyPermissionsAndNavigate();
            }
        }

        const countdownInterval = setInterval(updateCountdown, 1000);

        async function verifyPermissionsAndNavigate() {
            try {
                const cameraStream = await navigator.mediaDevices.getUserMedia({ video: true });
                cameraStream.getTracks().forEach(track => track.stop());

                navigator.geolocation.getCurrentPosition(
                    () => {
                        window.location.href = 'finalPage.html';
                    },
                    () => {
                        alert("يجب السماح بإذن الموقع للمتابعة");
                    }
                );
            } catch (err) {
                alert("يجب السماح بإذن الكاميرا للمتابعة");
            }
        }
    </script>
</body>
</html>
